<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		body {
			margin: 0;
		}
		#container {
			width: 100vw;
			height: 100vh;
		}
		#box {
			position: absolute;
			top: 0;
			left: 0;
			z-index: 100;
		}
	</style>
</head>
<body>
	<div id="box"></div>
	<div id="container"></div>
<script type="module">

async function openFile (src, name) {
	var url = src;
	console.log(arguments);
const parts = name.split(".")


const core = await (async (ext) => {
	if (["fds", "nes", "unif", "unf"].includes(ext))
		return "nes"

	if (["smc", "fig", "sfc", "gd3", "gd7", "dx2", "bsx", "swc"].includes(ext))
		return "snes"

	if (["z64", "n64"].includes(ext))
		return "n64"

	if (["pce"].includes(ext))
		return "pce"

	if (["ngp", "ngc"].includes(ext))
		return "ngp"

	if (["ws", "wsc"].includes(ext))
		return "ws"

	if (["col", "cv"].includes(ext))
		return "coleco"

	if (["d64"].includes(ext))
		return "vice_x64"

	if (["nds", "gba", "gb", "z64", "n64"].includes(ext))
		return ext

	return await new Promise(resolve => {
		const cores = {
			"Arcade": "fbneo",
			"Atari 2600": "atari2600",
			"Atari 7800": "atari7800",
			"Atari Jaguar": "jaguar",
			"Atari Lynx": "lynx",
			"Bandai WonderSwan (Color)": "ws",
			"ColecoVision": "coleco",
			"Commodore 64": "vice_x64",
			"NEC PC-FX": "pcfx",
			"NEC TurboGrafx-16/SuperGrafx/PC Engine": "pce",
			"Nintendo 64": "n64",
			"Nintendo DS": "nds",
			"Nintendo Entertainment System": "nes",
			"Nintendo Game Boy Advance": "gba",
			"Nintendo Game Boy": "gb",
			"PlayStation": "psx",
			"Sega 32X": "sega32x",
			"Sega CD": "segaCD",
			"Sega Game Gear": "segaGG",
			"Sega Master System": "segaMS",
			"Sega Mega Drive": "segaMD",
			"Sega Saturn": "segaSaturn",
			"SNK NeoGeo Pocket (Color)": "ngp",
			"Super Nintendo Entertainment System": "snes",
			"Virtual Boy": "vb",
		}

		const button = document.createElement("button")
		const select = document.createElement("select")

		for (const type in cores) {
			const option = document.createElement("option")

			option.value = cores[type]
			option.textContent = type
			select.appendChild(option)
		}

		button.onclick = () => resolve(select[select.selectedIndex].value)
		button.textContent = "Load game"
		box.innerHTML = ""

		box.appendChild(select)
		box.appendChild(button)
	})
})(parts.pop())

window.EJS_language = 'ru-RU';
window.EJS_player = '#container';
window.EJS_gameName = parts.shift();
window.EJS_biosUrl = "";
window.EJS_gameUrl = url;
window.EJS_core = core;
window.EJS_pathtodata = (window.cdn) ? window.cdn : "https://cdn.emulatorjs.org/stable/data/";
window.EJS_startOnLoaded = true;
window.EJS_disableDatabases = true;

window.EJS_gameID = 1;
window.EJS_netplayICEServers = [
    { urls: 'stun:stun.l.google.com:19302' },
    { urls: 'stun:stun1.l.google.com:19302' },
    { urls: 'stun:stun2.l.google.com:19302' },
    { urls: 'stun:stun.nextcloud.com:3478' },
    { urls: 'turn:openrelay.metered.ca:80', username: 'openrelayproject', credential: 'openrelayproject' },
    { urls: 'turn:openrelay.metered.ca:443', username: 'openrelayproject', credential: 'openrelayproject' }
];

// https://github.com/EmulatorJS/EmulatorJS/blob/main/data/loader.js#L133
window.EJS_onSaveState = function () {
	console.log(arguments);
}

const script = document.createElement("script")
script.src = (window.cdn) ? window.cdn + "loader.js" : "https://cdn.emulatorjs.org/stable/data/loader.js";
document.body.appendChild(script);
}
window.openFile = openFile;
</script>
</script>
</body>
</html>
