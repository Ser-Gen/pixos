<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		body {
			margin: 0;
		}
		#container {
			width: 100vw;
			height: 100vh;
		}
	</style>

	<script src="../jszip.3.10.1.min.js"></script>
	<script src="js-dos.js"></script>
	<link href="js-dos.css" rel="stylesheet">
</head>
<body>
<div id="container"></div>
<script>
function openFile (src) {
	if (src.match(/.jsdos$/)) {
		start(src);
	}
	else if (src.match(/.zip$/)) {
		var zip = new JSZip();
		fetch('dosbox.conf').then(r=>r.text()).then(dosboxconf=>{
			fetch(src).then(r=>r.arrayBuffer()).then(ab => {
				processDosZip(ab, dosboxconf)
			});
		});

		function processDosZip (zipFile, dosboxconf) {
			zip.loadAsync(zipFile).then(zip => {
				zip.file(".jsdos/dosbox.conf", dosboxconf);
				zip.generateAsync({
					type: "blob",
					compression: "DEFLATE",
					compressionOptions: {
						level: 6
					}
				}).then(arch=>{
					var src = URL.createObjectURL(arch);

					start(src);
				})
			});
		}
	}
}

function start (src) {
	var d = Dos(document.getElementById("container"));
	d.run(src);
}
</script>
</body>
</html>
